<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3D Print Cost Calculator</title>
  <style>
    :root{
      --gap:14px;
    }
    body{
      font-family: Arial, sans-serif;
      margin:20px;
      padding:10px;
      background:#f5f5f5;
    }
    .container{
      max-width: 440px;
      margin:auto;
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:0 0 10px rgba(0,0,0,.08);
    }
    h2{ margin-top:0; }

    label{
      font-weight:700;
      display:block;
      margin-top:12px;
      margin-bottom:6px;
    }
    input, select{
      width:100%;
      padding:10px;
      border:1px solid #d7d7d7;
      border-radius:8px;
      background:#fff;
    }
    .row-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--gap);
      margin-top: var(--gap);
    }
    .checkbox-group{
      display:flex; align-items:center; gap:8px; margin-top:10px;
    }
    button{
      width:100%; padding:12px; margin-top:18px;
      background:#28a745; color:#fff; border:none; border-radius:8px; cursor:pointer;
    }
    button:hover{ background:#218838; }

    .reference-table{
      max-width:440px; margin:20px auto 0; padding:12px; background:#fff;
      border-radius:10px; box-shadow:0 0 6px rgba(0,0,0,.06);
    }
    .muted{ color:#666; font-size:12px; margin-top:4px; }
    @media (max-width: 420px){
      :root{ --gap:12px; }
      .container{ padding:16px; }
      input, select{ padding:11px; }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>3D Print Cost Calculator</h2>

  <label>Material</label>
  <select id="material">
    <option value="PLA+">PLA+</option>
    <option value="PLA">PLA</option>
    <option value="PETG">PETG</option>
    <option value="ABS">ABS</option>
  </select>

  <label>Material Cost (AED/kg):</label>
  <input type="number" id="materialCost" value="100" step="0.01"/>

  <div class="row-2">
    <div>
      <label>Weight (g):</label>
      <input type="number" id="weight" placeholder="e.g. 50" step="0.01"/>
    </div>
    <div>
      <label>Print Time (h):</label>
      <input type="number" id="printTime" placeholder="e.g. 5.5" step="0.01"/>
    </div>
  </div>

  <div class="row-2">
    <div>
      <label>Preparation Time (h):</label>
      <input type="number" id="prepTime" value="0" step="0.01"/>
    </div>
    <div>
      <label>Post-Processing (h):</label>
      <input type="number" id="postProcessingH" value="0" step="0.01"/>
    </div>
  </div>

  <label>Labor Rate (AED/h):</label>
  <input type="number" id="laborRate" value="200" step="0.01"/>
  <div class="muted">Used for both Preparation and Post-Processing</div>

  <label>Printer</label>
  <select id="printer">
    <option value="Bambu Lab X1-Carbon Combo">Bambu Lab X1-Carbon Combo (1.66 AED/h)</option>
    <option value="Bambu Lab A1 Combo">Bambu Lab A1 Combo (1.30 AED/h)</option>
    <option value="Ankermake M5">Ankermake M5 (0.83 AED/h)</option>
    <option value="Ankermake M5C">Ankermake M5C (0.67 AED/h)</option>
    <option value="Creality Hi">Creality Hi (0.93 AED/h)</option>
  </select>

  <label>Packaging Cost (AED):</label>
  <input type="number" id="packagingCost" value="0" step="0.01"/>

  <label>Extra Fees (AED):</label>
  <input type="number" id="extraFees" value="0" step="0.01"/>

  <label>Profit Margin:</label>
  <select id="profitMargin">
    <option value="60">60%</option>
    <option value="50">50%</option>
    <option value="40">40%</option>
    <option value="30">30%</option>
  </select>

  <div class="checkbox-group">
    <input type="checkbox" id="shopifyFee"/>
    <label for="shopifyFee">Include Shopify Fee (4.4%)</label>
  </div>

  <div class="checkbox-group">
    <input type="checkbox" id="vat"/>
    <label for="vat">Include VAT (5%)</label>
  </div>

  <button onclick="calculateCost()">Calculate</button>

  <h3>Results:</h3>
  <p>Total Cost: <strong id="totalCost">-</strong> AED</p>
  <p>Selling Price: <strong id="sellingPrice">-</strong> AED</p>

  <label>Part Name:</label>
  <input type="text" id="partName" placeholder="Enter part name"/>

  <button onclick="saveInquiry()">Save to Google Sheets</button>
</div>

<div class="reference-table">
  <h3>Reference Values</h3>
  <p>Printer Depreciation: chosen from list (AED/h)</p>
  <p>Labor Rate: configurable (AED/h), applied to Preparation + Post-Processing</p>
  <p>Failure Rate: 10%</p>
  <p>Shopify Fee: 4.4% (if selected)</p>
  <p>VAT: 5% (if selected)</p>
</div>

<script>
  // Depreciation / machine rate (AED per hour) by printer
  const PRINTER_RATES = {
    "Bambu Lab X1-Carbon Combo": 1.66,
    "Bambu Lab A1 Combo": 1.30,
    "Ankermake M5": 0.83,
    "Ankermake M5C": 0.67,
    "Creality Hi": 0.93
  };

  const num = id => {
    const v = parseFloat(document.getElementById(id).value);
    return isNaN(v) ? 0 : v;
  };

  function calculateCost(){
    const materialCostPerKg = num("materialCost");
    const weightG           = num("weight");
    const printTimeH        = num("printTime");
    const prepTimeH         = num("prepTime");
    const postProcH         = num("postProcessingH");
    const laborRate         = num("laborRate");
    const packagingCost     = num("packagingCost");
    const extraFees         = num("extraFees");

    const printerName       = document.getElementById("printer").value;
    const printerRate       = PRINTER_RATES[printerName] || 0;

    const profitMargin      = parseFloat(document.getElementById("profitMargin").value) / 100;
    const includeShopify    = document.getElementById("shopifyFee").checked;
    const includeVAT        = document.getElementById("vat").checked;

    // Core costs
    const materialCost = (materialCostPerKg / 1000) * weightG;        // AED
    const machineCost  = printTimeH * printerRate;                     // AED (depreciation only while printing)
    const laborCost    = (prepTimeH + postProcH) * laborRate;          // AED

    // Base cost before margin/fees
    let cost = materialCost + machineCost + laborCost;

    // Failure rate (10%)
    cost *= 1.10;

    // Add extras
    cost += packagingCost + extraFees;

    // Selling price with margin
    let sellingPrice = cost * (1 + profitMargin);

    // Shopify fee (4.4%)
    if (includeShopify) sellingPrice *= 1.044;

    // VAT (5%)
    if (includeVAT) sellingPrice *= 1.05;

    document.getElementById("totalCost").innerText   = cost.toFixed(2);
    document.getElementById("sellingPrice").innerText= sellingPrice.toFixed(2);
  }

  // Save to SheetDB
  function saveInquiry(){
    const partName      = document.getElementById("partName").value.trim();
    const material      = document.getElementById("material").value.trim();
    const printer       = document.getElementById("printer").value.trim();

    const payload = {
      data: [{
        "Part Name": partName,
        "Material": material,
        "Printer": printer,
        "Weight (g)": document.getElementById("weight").value.trim(),
        "Print Time (h)": document.getElementById("printTime").value.trim(),
        "Prep Time (h)": document.getElementById("prepTime").value.trim(),
        "Post-Processing (h)": document.getElementById("postProcessingH").value.trim(),
        "Labor Rate (AED/h)": document.getElementById("laborRate").value.trim(),
        "Packaging Cost (AED)": document.getElementById("packagingCost").value.trim(),
        "Extra Fees (AED)": document.getElementById("extraFees").value.trim(),
        "Cost (AED)": document.getElementById("totalCost").innerText.trim(),
        "Margin": document.getElementById("profitMargin").value.trim(),
        "Price (AED)": document.getElementById("sellingPrice").innerText.trim(),
        "Date": new Date().toLocaleDateString()
      }]
    };

    const sheetdbUrl = "https://sheetdb.io/api/v1/0p74ykwl0aai4";

    fetch(sheetdbUrl, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    })
    .then(r => r.json())
    .then(() => alert("Saved successfully!"))
    .catch(err => { console.error(err); alert("Error saving data!"); });
  }
</script>

</body>
</html>