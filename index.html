<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Print Price Calculator</title>
    <script>
        function calculatePrice() {
            let partName = document.getElementById("partName").value;
            let materialCost = parseFloat(document.getElementById("materialCost").value);
            let weight = parseFloat(document.getElementById("weight").value);
            let printTime = parseFloat(document.getElementById("printTime").value);
            let packaging = parseFloat(document.getElementById("packaging").value);
            let profitMultiplier = parseFloat(document.getElementById("profitMargin").value);
            let hasPostProcessing = document.getElementById("postProcess").checked;
            let postProcessingTime = hasPostProcessing ? parseFloat(document.getElementById("postTime").value) : 0;
            let includeShopify = document.getElementById("shopifyFee").checked;
            let includeVAT = document.getElementById("vatFee").checked;

            // Constants
            let failureRate = 0.10;  // 10% extra material cost
            let maintenanceCost = 0.7;  // AED per hour
            let electricityRate = 0.0075;  // AED per kWh
            let laborCost = 40 / 60;  // AED per minute
            let shopifyMultiplier = includeShopify ? 1.044 : 1;  // Apply Shopify fee if checked
            let vatMultiplier = includeVAT ? 1.05 : 1;  // Apply VAT if checked

            // Calculate costs
            let materialTotal = (weight / 1000) * materialCost * (1 + failureRate);
            let machineCost = printTime * maintenanceCost;
            let electricityCost = printTime * electricityRate;
            let postProcessingCost = postProcessingTime * laborCost;

            let totalCost = materialTotal + machineCost + electricityCost + postProcessingCost + packaging;
            let finalPrice = totalCost * profitMultiplier * shopifyMultiplier * vatMultiplier;

            // Display result
            document.getElementById("result").innerHTML = "Selling Price: " + finalPrice.toFixed(2) + " AED";
            document.getElementById("totalCost").value = totalCost.toFixed(2);
            document.getElementById("sellingPrice").value = finalPrice.toFixed(2);
        }

        function saveInquiry() {
            let partName = document.getElementById("partName").value;
            let weight = document.getElementById("weight").value;
            let printTime = document.getElementById("printTime").value;
            let totalCost = document.getElementById("totalCost").value;
            let sellingPrice = document.getElementById("sellingPrice").value;

            if (partName === "" || weight === "" || printTime === "" || sellingPrice === "") {
                alert("Please calculate the price before saving.");
                return;
            }

            fetch("https://script.google.com/macros/library/d/1VflXuc993WB3IeSQJ5LluQ7K_l6TkL8UJYZJWQHJNL_TFMnZTIKAa_7p/1", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ partName, weight, printTime, totalCost, sellingPrice })
            })
            .then(response => response.text())
            .then(data => alert("Saved Successfully!"));
        }

        function togglePostProcessing() {
            document.getElementById("postProcessingTime").style.display = document.getElementById("postProcess").checked ? "block" : "none";
        }
    </script>

    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: auto; }
        h2, h3 { color: #333; text-align: center; }
        label { font-weight: bold; display: block; margin-top: 10px; }
        input, select, button { width: 100%; padding: 10px; margin-top: 5px; font-size: 16px; }
        button { background-color: #007BFF; color: white; border: none; cursor: pointer; margin-top: 15px; }
        button:hover { background-color: #0056b3; }
        .checkbox-group { display: flex; justify-content: space-between; margin-top: 10px; }
        .checkbox-group label { font-weight: normal; font-size: 14px; }
    </style>
</head>
<body>
    <h2>3D Print Price Calculator</h2>

    <label>Part Name:</label>
    <input type="text" id="partName" placeholder="Enter Part Name">

    <label>Material Cost (AED/kg):</label>
    <input type="number" id="materialCost" value="100">

    <label>Weight (g):</label>
    <input type="number" id="weight" value="50">

    <label>Print Time (hours):</label>
    <input type="number" id="printTime" value="2">

    <label>Packaging Cost (AED):</label>
    <select id="packaging">
        <option value="2">Small - 2 AED</option>
        <option value="3">Medium - 3 AED</option>
        <option value="5">Large - 5 AED</option>
        <option value="10">XL - 10 AED</option>
    </select>

    <label>Profit Margin:</label>
    <select id="profitMargin">
        <option value="1.3">30%</option>
        <option value="1.4">40%</option>
        <option value="1.5">50%</option>
        <option value="1.6" selected>60%</option>
    </select>

    <input type="checkbox" id="postProcess" onclick="togglePostProcessing()"> <label>Include Post-Processing?</label>

    <div id="postProcessingTime" style="display:none;">
        <label>Post-Processing Time (minutes):</label>
        <input type="number" id="postTime" value="10">
    </div>

    <div class="checkbox-group">
        <label><input type="checkbox" id="shopifyFee"> Include Shopify Fee (4.4%)</label>
        <label><input type="checkbox" id="vatFee"> Include VAT (5%)</label>
    </div>

    <button onclick="calculatePrice()">Calculate</button>

    <h3 id="result">Selling Price: -- AED</h3>

    <input type="hidden" id="totalCost">
    <input type="hidden" id="sellingPrice">

    <button onclick="saveInquiry()">Save Inquiry</button>
</body>
</html>
